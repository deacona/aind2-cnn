from keras.callbacks import ModelCheckpoint   

# train the model
checkpointer = ModelCheckpoint(filepath='model.weights.best.hdf5', verbose=1, 
                               save_best_only=True)
hist = model.fit(x_train, y_train, batch_size=32, epochs=100,
          validation_data=(x_valid, y_valid), callbacks=[checkpointer], 
          verbose=2, shuffle=True)

Train on 45000 samples, validate on 5000 samples
Epoch 1/100
Epoch 00000: val_loss improved from inf to 1.33001, saving model to model.weights.best.hdf5
88s - loss: 1.6033 - acc: 0.4191 - val_loss: 1.3300 - val_acc: 0.5340
Epoch 2/100
Epoch 00001: val_loss improved from 1.33001 to 1.19205, saving model to model.weights.best.hdf5
82s - loss: 1.3030 - acc: 0.5322 - val_loss: 1.1920 - val_acc: 0.5774
Epoch 3/100
Epoch 00002: val_loss improved from 1.19205 to 1.15436, saving model to model.weights.best.hdf5
81s - loss: 1.1874 - acc: 0.5757 - val_loss: 1.1544 - val_acc: 0.5972
Epoch 4/100
Epoch 00003: val_loss improved from 1.15436 to 1.11979, saving model to model.weights.best.hdf5
82s - loss: 1.1131 - acc: 0.6068 - val_loss: 1.1198 - val_acc: 0.6206
Epoch 5/100
Epoch 00004: val_loss improved from 1.11979 to 1.08789, saving model to model.weights.best.hdf5
80s - loss: 1.0643 - acc: 0.6303 - val_loss: 1.0879 - val_acc: 0.6178
Epoch 6/100
Epoch 00005: val_loss improved from 1.08789 to 0.95395, saving model to model.weights.best.hdf5
78s - loss: 1.0415 - acc: 0.6376 - val_loss: 0.9540 - val_acc: 0.6754
Epoch 7/100
Epoch 00006: val_loss did not improve
83s - loss: 1.0269 - acc: 0.6470 - val_loss: 0.9791 - val_acc: 0.6712
Epoch 8/100
Epoch 00007: val_loss did not improve
80s - loss: 1.0180 - acc: 0.6509 - val_loss: 0.9768 - val_acc: 0.6794
Epoch 9/100
Epoch 00008: val_loss did not improve
76s - loss: 1.0217 - acc: 0.6544 - val_loss: 1.0143 - val_acc: 0.6676
Epoch 10/100
Epoch 00009: val_loss did not improve
76s - loss: 1.0211 - acc: 0.6552 - val_loss: 1.1904 - val_acc: 0.6348
Epoch 11/100
Epoch 00010: val_loss did not improve
76s - loss: 1.0308 - acc: 0.6541 - val_loss: 1.0707 - val_acc: 0.6464
Epoch 12/100
Epoch 00011: val_loss did not improve
76s - loss: 1.0467 - acc: 0.6498 - val_loss: 1.3161 - val_acc: 0.6188
Epoch 13/100
Epoch 00012: val_loss did not improve
80s - loss: 1.0573 - acc: 0.6447 - val_loss: 1.1021 - val_acc: 0.6464
Epoch 14/100
Epoch 00013: val_loss did not improve
78s - loss: 1.0723 - acc: 0.6436 - val_loss: 1.3899 - val_acc: 0.5296
Epoch 15/100
Epoch 00014: val_loss did not improve
77s - loss: 1.0904 - acc: 0.6375 - val_loss: 1.0409 - val_acc: 0.6612
Epoch 16/100
Epoch 00015: val_loss did not improve
73s - loss: 1.1071 - acc: 0.6338 - val_loss: 1.0339 - val_acc: 0.6576
Epoch 17/100
Epoch 00016: val_loss did not improve
73s - loss: 1.1241 - acc: 0.6290 - val_loss: 1.0985 - val_acc: 0.6512
Epoch 18/100
Epoch 00017: val_loss did not improve
72s - loss: 1.1503 - acc: 0.6196 - val_loss: 1.3519 - val_acc: 0.5438
Epoch 19/100
Epoch 00018: val_loss did not improve
73s - loss: 1.1523 - acc: 0.6190 - val_loss: 1.1102 - val_acc: 0.6300
Epoch 20/100
Epoch 00019: val_loss did not improve
73s - loss: 1.1828 - acc: 0.6134 - val_loss: 0.9984 - val_acc: 0.6736
Epoch 21/100
Epoch 00020: val_loss did not improve
76s - loss: 1.2090 - acc: 0.5994 - val_loss: 1.0895 - val_acc: 0.6510
Epoch 22/100
Epoch 00021: val_loss did not improve
77s - loss: 1.2284 - acc: 0.5981 - val_loss: 1.1177 - val_acc: 0.6382
Epoch 23/100
Epoch 00022: val_loss did not improve
78s - loss: 1.2495 - acc: 0.5892 - val_loss: 1.8909 - val_acc: 0.5910
Epoch 24/100
Epoch 00023: val_loss did not improve
79s - loss: 1.2604 - acc: 0.5836 - val_loss: 1.2626 - val_acc: 0.6028
Epoch 25/100
Epoch 00024: val_loss did not improve
78s - loss: 1.2756 - acc: 0.5810 - val_loss: 1.2154 - val_acc: 0.6132
Epoch 26/100
Epoch 00025: val_loss did not improve
78s - loss: 1.2965 - acc: 0.5720 - val_loss: 1.4980 - val_acc: 0.5838
Epoch 27/100
Epoch 00026: val_loss did not improve
78s - loss: 1.3109 - acc: 0.5660 - val_loss: 1.3093 - val_acc: 0.5838
Epoch 28/100
Epoch 00027: val_loss did not improve
78s - loss: 1.3249 - acc: 0.5669 - val_loss: 1.1710 - val_acc: 0.6158
Epoch 29/100
Epoch 00028: val_loss did not improve
77s - loss: 1.3296 - acc: 0.5602 - val_loss: 1.1554 - val_acc: 0.6318
Epoch 30/100
Epoch 00029: val_loss did not improve
78s - loss: 1.3452 - acc: 0.5510 - val_loss: 1.1418 - val_acc: 0.6092
Epoch 31/100
Epoch 00030: val_loss did not improve
79s - loss: 1.3828 - acc: 0.5422 - val_loss: 1.2899 - val_acc: 0.5530
Epoch 32/100
Epoch 00031: val_loss did not improve
80s - loss: 1.3742 - acc: 0.5448 - val_loss: 1.4247 - val_acc: 0.5966
Epoch 33/100
Epoch 00032: val_loss did not improve
80s - loss: 1.3921 - acc: 0.5372 - val_loss: 1.3250 - val_acc: 0.5592
Epoch 34/100
Epoch 00033: val_loss did not improve
81s - loss: 1.4202 - acc: 0.5331 - val_loss: 1.2178 - val_acc: 0.5878
Epoch 35/100
Epoch 00034: val_loss did not improve
77s - loss: 1.4275 - acc: 0.5238 - val_loss: 1.2471 - val_acc: 0.5774
Epoch 36/100
Epoch 00035: val_loss did not improve
79s - loss: 1.4418 - acc: 0.5205 - val_loss: 1.5014 - val_acc: 0.5380
Epoch 37/100
Epoch 00036: val_loss did not improve
77s - loss: 1.4493 - acc: 0.5185 - val_loss: 1.4965 - val_acc: 0.4906
Epoch 38/100
Epoch 00037: val_loss did not improve
79s - loss: 1.4392 - acc: 0.5170 - val_loss: 1.6522 - val_acc: 0.4806
Epoch 39/100
Epoch 00038: val_loss did not improve
77s - loss: 1.4626 - acc: 0.5140 - val_loss: 1.2857 - val_acc: 0.5414
Epoch 40/100
Epoch 00039: val_loss did not improve
78s - loss: 1.4558 - acc: 0.5148 - val_loss: 1.5512 - val_acc: 0.4530
Epoch 41/100
Epoch 00040: val_loss did not improve
80s - loss: 1.4751 - acc: 0.5040 - val_loss: 1.2640 - val_acc: 0.5598
Epoch 42/100
Epoch 00041: val_loss did not improve
78s - loss: 1.4924 - acc: 0.5005 - val_loss: 1.5730 - val_acc: 0.4630
Epoch 43/100
Epoch 00042: val_loss did not improve
76s - loss: 1.4842 - acc: 0.5036 - val_loss: 1.2990 - val_acc: 0.5686
Epoch 44/100
Epoch 00043: val_loss did not improve
76s - loss: 1.5078 - acc: 0.4963 - val_loss: 1.3444 - val_acc: 0.5390
Epoch 45/100
Epoch 00044: val_loss did not improve
79s - loss: 1.5138 - acc: 0.4919 - val_loss: 1.8802 - val_acc: 0.4402
Epoch 46/100
Epoch 00045: val_loss did not improve
78s - loss: 1.5190 - acc: 0.4897 - val_loss: 1.3809 - val_acc: 0.5124
Epoch 47/100
Epoch 00046: val_loss did not improve
76s - loss: 1.5266 - acc: 0.4835 - val_loss: 1.5034 - val_acc: 0.5590
Epoch 48/100
Epoch 00047: val_loss did not improve
78s - loss: 1.5288 - acc: 0.4834 - val_loss: 1.7143 - val_acc: 0.4644
Epoch 49/100
Epoch 00048: val_loss did not improve
80s - loss: 1.5391 - acc: 0.4790 - val_loss: 3.3547 - val_acc: 0.3808
Epoch 50/100
Epoch 00049: val_loss did not improve
85s - loss: 1.5492 - acc: 0.4790 - val_loss: 1.3212 - val_acc: 0.5434
Epoch 51/100
Epoch 00050: val_loss did not improve
83s - loss: 1.5643 - acc: 0.4708 - val_loss: 1.6721 - val_acc: 0.4882
Epoch 52/100
Epoch 00051: val_loss did not improve
81s - loss: 1.5824 - acc: 0.4645 - val_loss: 2.2366 - val_acc: 0.4302
Epoch 53/100
Epoch 00052: val_loss did not improve
82s - loss: 1.6081 - acc: 0.4595 - val_loss: 1.5132 - val_acc: 0.5230
Epoch 54/100
Epoch 00053: val_loss did not improve
79s - loss: 1.5954 - acc: 0.4588 - val_loss: 1.4621 - val_acc: 0.4664
Epoch 55/100
Epoch 00054: val_loss did not improve
79s - loss: 1.6071 - acc: 0.4551 - val_loss: 1.3885 - val_acc: 0.5272
Epoch 56/100
Epoch 00055: val_loss did not improve
81s - loss: 1.6270 - acc: 0.4498 - val_loss: 1.4349 - val_acc: 0.4714
Epoch 57/100
Epoch 00056: val_loss did not improve
83s - loss: 1.6342 - acc: 0.4458 - val_loss: 1.8173 - val_acc: 0.4536
Epoch 58/100
Epoch 00057: val_loss did not improve
80s - loss: 1.6316 - acc: 0.4454 - val_loss: 1.4608 - val_acc: 0.5092
Epoch 59/100
Epoch 00058: val_loss did not improve
80s - loss: 1.6380 - acc: 0.4351 - val_loss: 1.5221 - val_acc: 0.4302
Epoch 60/100
Epoch 00059: val_loss did not improve
77s - loss: 1.6134 - acc: 0.4452 - val_loss: 1.4554 - val_acc: 0.4962
Epoch 61/100
Epoch 00060: val_loss did not improve
82s - loss: 1.6189 - acc: 0.4446 - val_loss: 1.3448 - val_acc: 0.5136
Epoch 62/100
Epoch 00061: val_loss did not improve
82s - loss: 1.6409 - acc: 0.4394 - val_loss: 1.2945 - val_acc: 0.5520
Epoch 63/100
Epoch 00062: val_loss did not improve
78s - loss: 1.6464 - acc: 0.4434 - val_loss: 1.9097 - val_acc: 0.4194
Epoch 64/100
Epoch 00063: val_loss did not improve
77s - loss: 1.6588 - acc: 0.4359 - val_loss: 1.6781 - val_acc: 0.4834
Epoch 65/100
Epoch 00064: val_loss did not improve
79s - loss: 1.6510 - acc: 0.4322 - val_loss: 2.1195 - val_acc: 0.4536
Epoch 66/100
Epoch 00065: val_loss did not improve
82s - loss: 1.6653 - acc: 0.4234 - val_loss: 1.2966 - val_acc: 0.5442
Epoch 67/100
Epoch 00066: val_loss did not improve
92s - loss: 1.6802 - acc: 0.4191 - val_loss: 1.4596 - val_acc: 0.4700
Epoch 68/100
Epoch 00067: val_loss did not improve
84s - loss: 1.6894 - acc: 0.4207 - val_loss: 1.6390 - val_acc: 0.4570
Epoch 69/100
Epoch 00068: val_loss did not improve
87s - loss: 1.6904 - acc: 0.4197 - val_loss: 1.6436 - val_acc: 0.4370
Epoch 70/100
Epoch 00069: val_loss did not improve
86s - loss: 1.7273 - acc: 0.4070 - val_loss: 1.4888 - val_acc: 0.4594
Epoch 71/100
Epoch 00070: val_loss did not improve
85s - loss: 1.7183 - acc: 0.4077 - val_loss: 1.6186 - val_acc: 0.4234
Epoch 72/100
Epoch 00071: val_loss did not improve
81s - loss: 1.7156 - acc: 0.4024 - val_loss: 1.5191 - val_acc: 0.4620
Epoch 73/100
Epoch 00072: val_loss did not improve
80s - loss: 1.7333 - acc: 0.3979 - val_loss: 1.7309 - val_acc: 0.4588
Epoch 74/100
Epoch 00073: val_loss did not improve
83s - loss: 1.7428 - acc: 0.3960 - val_loss: 2.2598 - val_acc: 0.3224
Epoch 75/100
Epoch 00074: val_loss did not improve
81s - loss: 1.7409 - acc: 0.3986 - val_loss: 1.5258 - val_acc: 0.4450
Epoch 76/100
Epoch 00075: val_loss did not improve
81s - loss: 1.7315 - acc: 0.3962 - val_loss: 3.3353 - val_acc: 0.3160
Epoch 77/100
Epoch 00076: val_loss did not improve
82s - loss: 1.7502 - acc: 0.3910 - val_loss: 1.6940 - val_acc: 0.4090
Epoch 78/100
Epoch 00077: val_loss did not improve
81s - loss: 1.7462 - acc: 0.3880 - val_loss: 1.7818 - val_acc: 0.4326
Epoch 79/100
Epoch 00078: val_loss did not improve
83s - loss: 1.7488 - acc: 0.3914 - val_loss: 1.5614 - val_acc: 0.4682
Epoch 80/100
Epoch 00079: val_loss did not improve
78s - loss: 1.7417 - acc: 0.3924 - val_loss: 1.8925 - val_acc: 0.3718
Epoch 81/100
Epoch 00080: val_loss did not improve
77s - loss: 1.7505 - acc: 0.3889 - val_loss: 1.5680 - val_acc: 0.4400
Epoch 82/100
Epoch 00081: val_loss did not improve
77s - loss: 1.7648 - acc: 0.3879 - val_loss: 1.9677 - val_acc: 0.3990
Epoch 83/100
Epoch 00082: val_loss did not improve
79s - loss: 1.7611 - acc: 0.3878 - val_loss: 1.4948 - val_acc: 0.4792
Epoch 84/100
Epoch 00083: val_loss did not improve
81s - loss: 1.7807 - acc: 0.3810 - val_loss: 1.5349 - val_acc: 0.4540
Epoch 85/100
Epoch 00084: val_loss did not improve
77s - loss: 1.7922 - acc: 0.3714 - val_loss: 1.5730 - val_acc: 0.4388
Epoch 86/100
Epoch 00085: val_loss did not improve
76s - loss: 1.7983 - acc: 0.3720 - val_loss: 1.6495 - val_acc: 0.3602
Epoch 87/100
Epoch 00086: val_loss did not improve
76s - loss: 1.7932 - acc: 0.3692 - val_loss: 1.6388 - val_acc: 0.4158
Epoch 88/100
Epoch 00087: val_loss did not improve
76s - loss: 1.8053 - acc: 0.3674 - val_loss: 1.6652 - val_acc: 0.4602
Epoch 89/100
Epoch 00088: val_loss did not improve
77s - loss: 1.8187 - acc: 0.3650 - val_loss: 8.4520 - val_acc: 0.1810
Epoch 90/100
Epoch 00089: val_loss did not improve
76s - loss: 1.8063 - acc: 0.3665 - val_loss: 3.7053 - val_acc: 0.3082
Epoch 91/100
Epoch 00090: val_loss did not improve
76s - loss: 1.7956 - acc: 0.3664 - val_loss: 1.6107 - val_acc: 0.4196
Epoch 92/100
Epoch 00091: val_loss did not improve
77s - loss: 1.7892 - acc: 0.3728 - val_loss: 1.6328 - val_acc: 0.3862
Epoch 93/100
Epoch 00092: val_loss did not improve
76s - loss: 1.7989 - acc: 0.3683 - val_loss: 2.0142 - val_acc: 0.3808
Epoch 94/100
Epoch 00093: val_loss did not improve
76s - loss: 1.8020 - acc: 0.3671 - val_loss: 1.5187 - val_acc: 0.4366
Epoch 95/100
Epoch 00094: val_loss did not improve
76s - loss: 1.8035 - acc: 0.3696 - val_loss: 2.7122 - val_acc: 0.3234
Epoch 96/100
Epoch 00095: val_loss did not improve
76s - loss: 1.8111 - acc: 0.3652 - val_loss: 1.6292 - val_acc: 0.4002
Epoch 97/100
Epoch 00096: val_loss did not improve
77s - loss: 1.8003 - acc: 0.3630 - val_loss: 1.5790 - val_acc: 0.4376
Epoch 98/100
Epoch 00097: val_loss did not improve
76s - loss: 1.7941 - acc: 0.3647 - val_loss: 1.8683 - val_acc: 0.4032
Epoch 99/100
Epoch 00098: val_loss did not improve
76s - loss: 1.8226 - acc: 0.3571 - val_loss: 1.6596 - val_acc: 0.3576
Epoch 100/100
Epoch 00099: val_loss did not improve
76s - loss: 1.8340 - acc: 0.3551 - val_loss: 1.7346 - val_acc: 0.4064